(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&t(l)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function t(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();class O{static createButton(e,n={}){const t=document.createElement("button");function r(i){let E=null;async function v(p){p.addEventListener("end",g),await e.xr.setSession(p),t.textContent="STOP XR",E=p}function g(){E.removeEventListener("end",g),t.textContent="START XR",E=null}t.style.display="",t.style.cursor="pointer",t.style.left="calc(50% - 50px)",t.style.width="100px",t.textContent="START XR";const x={...n,optionalFeatures:["local-floor","bounded-floor","layers",...n.optionalFeatures||[]]};t.onmouseenter=function(){t.style.opacity="1.0"},t.onmouseleave=function(){t.style.opacity="0.5"},t.onclick=function(){E===null?navigator.xr.requestSession(i,x).then(v):(E.end(),navigator.xr.offerSession!==void 0&&navigator.xr.offerSession(i,x).then(v).catch(p=>{console.warn(p)}))},navigator.xr.offerSession!==void 0&&navigator.xr.offerSession(i,x).then(v).catch(p=>{console.warn(p)})}function a(){t.style.display="",t.style.cursor="auto",t.style.left="calc(50% - 75px)",t.style.width="150px",t.onmouseenter=null,t.onmouseleave=null,t.onclick=null}function l(){a(),t.textContent="XR NOT SUPPORTED"}function c(i){a(),console.warn("Exception when trying to call xr.isSessionSupported",i),t.textContent="XR NOT ALLOWED"}function d(i){i.style.position="absolute",i.style.bottom="20px",i.style.padding="12px 6px",i.style.border="1px solid #fff",i.style.borderRadius="4px",i.style.background="rgba(0,0,0,0.1)",i.style.color="#fff",i.style.font="normal 13px sans-serif",i.style.textAlign="center",i.style.opacity="0.5",i.style.outline="none",i.style.zIndex="999"}if("xr"in navigator)return t.id="XRButton",t.style.display="none",d(t),navigator.xr.isSessionSupported("immersive-ar").then(function(i){i?r("immersive-ar"):navigator.xr.isSessionSupported("immersive-vr").then(function(E){E?r("immersive-vr"):l()}).catch(c)}).catch(c),t;{const i=document.createElement("a");return window.isSecureContext===!1?(i.href=document.location.href.replace(/^http:/,"https:"),i.innerHTML="WEBXR NEEDS HTTPS"):(i.href="https://immersiveweb.dev/",i.innerHTML="WEBXR NOT AVAILABLE"),i.style.left="calc(50% - 90px)",i.style.width="180px",i.style.textDecoration="none",d(i),i}}}class y{constructor(e,n,t,r){this.name=e,this.origin=n,this.u=t,this.v=r}viewMatrix(e){var n=new THREE.Vector3().crossVectors(this.u,this.v).normalize(),t=new THREE.Vector3().subVectors(e,n),r=new THREE.Vector3(0,1,0),a=new THREE.Matrix4;a=a.lookAt(e,t,r);var l=new THREE.Matrix4().makeTranslation(-e.x,-e.y,-e.z);return a=a.multiplyMatrices(a,l),a}projectionMatrix(e,n,t){var r=new THREE.Vector3().crossVectors(this.u,this.v).normalize(),a=-r.dot(new THREE.Vector3().subVectors(this.origin,e)),l=this.u.clone().normalize(),c=this.v.clone().normalize(),d=new THREE.Vector3().subVectors(this.origin,e).dot(l),i=new THREE.Vector3().addVectors(this.origin,this.u).sub(e).dot(l),E=new THREE.Vector3().subVectors(this.origin,e).dot(c),v=new THREE.Vector3().addVectors(this.origin,this.v).sub(e).dot(c),g=d*n/a,x=i*n/a,p=E*n/a,j=v*n/a;return new THREE.Matrix4().makePerspective(g,x,j,p,n,t)}}var s,w,f,u,H,S,T,h,R,m,b=!1;function z(){var o=[];o.push(w.getObjectByName("Teapot")),o.push(h.getObjectByName("Head")),m=new THREE.DragControls(o,f,s.domElement),m.addEventListener("hoveron",function(e){R.enabled=!1}),m.addEventListener("hoveroff",function(e){R.enabled=!0}),m.addEventListener("dragstart",function(e){e.object.material.emissive.set(11184810)}),m.addEventListener("dragend",function(e){e.object.material.emissive.set(0)})}function A(){T=new THREE.Vector3(50,20,50);var o=new THREE.Vector3(-6.8/2,10,-6),e=new THREE.Vector3(6.8/2,10,-6);h=new THREE.Scene;var t=new THREE.SphereGeometry(10,32,22),r=new THREE.MeshPhongMaterial({color:11184810}),n=new THREE.Mesh(t,r);n.name="Head",n.position.set(T.x,T.y,T.z),h.add(n);var t=new THREE.SphereGeometry(3,32,22),r=new THREE.MeshPhongMaterial({color:16711680}),a=new THREE.Mesh(t,r);a.name="EyeL",a.position.set(o.x,o.y,o.z),n.add(a);var t=new THREE.SphereGeometry(3,32,22),r=new THREE.MeshPhongMaterial({color:255}),a=new THREE.Mesh(t,r);a.name="EyeR",a.position.set(e.x,e.y,e.z),n.add(a),M(h)}function D(){s=new THREE.WebGLRenderer({preserveDrawingBuffer:!0,antialiasing:!0}),s.autoClear=!1,s.setPixelRatio(window.devicePixelRatio),s.setSize(window.innerWidth,window.innerHeight),s.setAnimationLoop(C),s.shadowMap.enabled=!0,s.xr.enabled=!0,s.xr.cameraAutoUpdate=!0,document.body.appendChild(s.domElement),s.xr.addEventListener("sessionstart",()=>{R.enabled=!1,m.enabled=!1}),s.xr.addEventListener("sessionend",()=>{R.enabled=!0,m.enabled=!0})}function F(o,e){R=new THREE.OrbitControls(o,e.domElement),R.minDistance=120,R.maxDistance=5e4}function M(o){var e=new THREE.AmbientLight(8947848,.4);o.add(e);var n=new THREE.PointLight(16777215,.8);n.position.z+=200,o.add(n)}function B(){w=new THREE.Scene;var o=new THREE.TeapotGeometry(40,15),e=new THREE.MeshPhongMaterial({color:16777215}),n=new THREE.Mesh(o,e);n.name="Teapot",n.position.z-=70,w.add(n),M(w)}function W(){H=new THREE.Scene;for(var[o,e]of u.entries()){var n=e.origin,t=e.u,r=e.v,a=new THREE.BoxGeometry(t.length(),r.length(),.01),l=new THREE.MeshPhongMaterial({map:S[o].texture}),c=new THREE.Mesh(a,l);c.name=e.name,e.name=="Left"&&(c.rotation.y=Math.PI/2),e.name=="Right"&&(c.rotation.y=-Math.PI/2),e.name=="Floor"&&(c.rotation.x=Math.PI/2,c.rotation.z=Math.PI);var d=t.clone().multiplyScalar(.5),i=r.clone().multiplyScalar(.5),E=new THREE.Vector3().addVectors(n,d);E.add(i),c.position.set(E.x,E.y,E.z),H.add(c)}M(H)}function X(){S=[];for(var e of u)S.push(new THREE.WebGLRenderTarget(1024,1024))}function N(){f=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e4),f.position.set(100,100,300),f.lookAt(0,0,0)}function k(){var o=300,e=o/2;u=[];var n=new y("Front",new THREE.Vector3(-e,-e,-e),new THREE.Vector3(o,0,0),new THREE.Vector3(0,o,0));u.push(n);var t=new y("Left",new THREE.Vector3(-e,-e,e),new THREE.Vector3(0,0,-o),new THREE.Vector3(0,o,0));u.push(t);var r=new y("Right",new THREE.Vector3(e,-e,-e),new THREE.Vector3(0,0,o),new THREE.Vector3(0,o,0));u.push(r);var a=new y("Floor",new THREE.Vector3(-e,-e,e),new THREE.Vector3(o,0,0),new THREE.Vector3(0,0,-o));u.push(a)}function L(){var o=h.getObjectByName("EyeL");return o.getWorldPosition(new THREE.Vector3)}function P(){var o=h.getObjectByName("EyeR");return o.getWorldPosition(new THREE.Vector3)}function V(o,e){var n=f.clone(),t=new THREE.Matrix4;return t.copy(o).invert(),n.position.set(t.elements[12],t.elements[13],t.elements[14]),n.setRotationFromMatrix(o),n.projectionMatrix=e.clone(),n}function I(){document.body.appendChild(O.createButton(s,{optionalFeatures:["depth-sensing"],depthSensing:{usagePreference:["gpu-optimized"],dataFormatPreference:[]}}))}function G(){f.aspect=window.innerWidth/window.innerHeight,f.updateProjectionMatrix(),s.setSize(window.innerWidth,window.innerHeight)}var C=function(){const o=s.getContext(),e=s.xr.isPresenting,n=e?s.xr.getCamera(f):f;let t=null,r=null;if(e)if(n.cameras&&n.cameras.length>=2){t=new THREE.Vector3().setFromMatrixPosition(n.cameras[0].matrixWorld),r=new THREE.Vector3().setFromMatrixPosition(n.cameras[1].matrixWorld);let l=t.clone().add(r).multiplyScalar(.5),c=r.clone().sub(t).normalize().multiplyScalar(6.8/2);t=l.clone().sub(c),r=l.clone().add(c),console.log("Realleft",t.toArray().map(d=>d.toFixed(3))),console.log("Realright",r.toArray().map(d=>d.toFixed(3))),console.log("Mid",l.toArray().map(d=>d.toFixed(3)))}else t=new THREE.Vector3().setFromMatrixPosition(n.matrixWorld),r=t.clone();s.setClearColor(8421504),s.clear(),b&&s.render(w,n);const a=s.xr.enabled;s.xr.enabled=!1;for(let[l,c]of u.entries()){s.setRenderTarget(S[l]),s.setClearColor(4210752),s.clear(),o.colorMask(!0,!1,!1,!0);{const d=t||L(),i=c.viewMatrix(d),E=c.projectionMatrix(d,1,1e4),v=V(i,E);s.render(w,v)}o.colorMask(!1,!1,!0,!0);{const d=r||P(),i=c.viewMatrix(d),E=c.projectionMatrix(d,1,1e4),v=V(i,E);s.clearDepth(),s.render(w,v)}o.colorMask(!0,!0,!0,!0)}s.xr.enabled=a,s.setRenderTarget(null),s.setClearColor(0),s.render(H,f),s.render(h,f)};window.addEventListener("keydown",function(o){switch(o.code){case"KeyL":var e=L();f.position.set(e.x,e.y,e.z);break;case"KeyR":var e=P();f.position.set(e.x,e.y,e.z);break;case"KeyS":b=!b;break;case"KeyT":var n=u[0].viewMatrix(new THREE.Vector3(50,20,100)),t=u[1].viewMatrix(new THREE.Vector3(50,20,100));console.log("View matrices:"),console.log(n),console.log(t);break;case"KeyY":var r=u[0].projectionMatrix(new THREE.Vector3(50,20,100),.1,100),a=u[1].projectionMatrix(new THREE.Vector3(50,20,100),.1,100),l=u[2].projectionMatrix(new THREE.Vector3(50,20,100),.1,100),c=u[3].projectionMatrix(new THREE.Vector3(50,20,100),.1,100);console.log("Projection matrices:"),console.log(r),console.log(a),console.log(l),console.log(c);break}});window.addEventListener("resize",G);D();I();k();X();W();A();B();N();F(f,s);z();C();
