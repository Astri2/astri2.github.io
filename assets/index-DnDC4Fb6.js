(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))t(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&t(l)}).observe(document,{childList:!0,subtree:!0});function r(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(a){if(a.ep)return;a.ep=!0;const o=r(a);fetch(a.href,o)}})();class O{static createButton(e,r={}){const t=document.createElement("button");function a(i){let d=null;async function h(f){f.addEventListener("end",g),await e.xr.setSession(f),t.textContent="STOP XR",d=f}function g(){d.removeEventListener("end",g),t.textContent="START XR",d=null}t.style.display="",t.style.cursor="pointer",t.style.left="calc(50% - 50px)",t.style.width="100px",t.textContent="START XR";const m={...r,optionalFeatures:["local-floor","bounded-floor","layers",...r.optionalFeatures||[]]};t.onmouseenter=function(){t.style.opacity="1.0"},t.onmouseleave=function(){t.style.opacity="0.5"},t.onclick=function(){d===null?navigator.xr.requestSession(i,m).then(h):(d.end(),navigator.xr.offerSession!==void 0&&navigator.xr.offerSession(i,m).then(h).catch(f=>{console.warn(f)}))},navigator.xr.offerSession!==void 0&&navigator.xr.offerSession(i,m).then(h).catch(f=>{console.warn(f)})}function o(){t.style.display="",t.style.cursor="auto",t.style.left="calc(50% - 75px)",t.style.width="150px",t.onmouseenter=null,t.onmouseleave=null,t.onclick=null}function l(){o(),t.textContent="XR NOT SUPPORTED"}function c(i){o(),console.warn("Exception when trying to call xr.isSessionSupported",i),t.textContent="XR NOT ALLOWED"}function w(i){i.style.position="absolute",i.style.bottom="20px",i.style.padding="12px 6px",i.style.border="1px solid #fff",i.style.borderRadius="4px",i.style.background="rgba(0,0,0,0.1)",i.style.color="#fff",i.style.font="normal 13px sans-serif",i.style.textAlign="center",i.style.opacity="0.5",i.style.outline="none",i.style.zIndex="999"}if("xr"in navigator)return t.id="XRButton",t.style.display="none",w(t),navigator.xr.isSessionSupported("immersive-ar").then(function(i){i?a("immersive-ar"):navigator.xr.isSessionSupported("immersive-vr").then(function(d){d?a("immersive-vr"):l()}).catch(c)}).catch(c),t;{const i=document.createElement("a");return window.isSecureContext===!1?(i.href=document.location.href.replace(/^http:/,"https:"),i.innerHTML="WEBXR NEEDS HTTPS"):(i.href="https://immersiveweb.dev/",i.innerHTML="WEBXR NOT AVAILABLE"),i.style.left="calc(50% - 90px)",i.style.width="180px",i.style.textDecoration="none",w(i),i}}}class T{constructor(e,r,t,a){this.name=e,this.origin=r,this.u=t,this.v=a}viewMatrix(e){var r=new THREE.Vector3().crossVectors(this.u,this.v).normalize(),t=new THREE.Vector3().subVectors(e,r),a=new THREE.Vector3(0,1,0),o=new THREE.Matrix4;o=o.lookAt(e,t,a);var l=new THREE.Matrix4().makeTranslation(-e.x,-e.y,-e.z);return o=o.multiplyMatrices(o,l),o}projectionMatrix(e,r,t){var a=new THREE.Vector3().crossVectors(this.u,this.v).normalize(),o=-a.dot(new THREE.Vector3().subVectors(this.origin,e)),l=this.u.clone().normalize(),c=this.v.clone().normalize(),w=new THREE.Vector3().subVectors(this.origin,e).dot(l),i=new THREE.Vector3().addVectors(this.origin,this.u).sub(e).dot(l),d=new THREE.Vector3().subVectors(this.origin,e).dot(c),h=new THREE.Vector3().addVectors(this.origin,this.v).sub(e).dot(c),g=w*r/o,m=i*r/o,f=d*r/o,C=h*r/o;return new THREE.Matrix4().makePerspective(g,m,C,f,r,t)}}var s,v,u,E,x,H,y,p,R,S=!0;function j(){var n=[];n.push(v.getObjectByName("Teapot")),n.push(p.getObjectByName("Head"));var e=new THREE.DragControls(n,u,s.domElement);e.addEventListener("hoveron",function(r){R.enabled=!1}),e.addEventListener("hoveroff",function(r){R.enabled=!0}),e.addEventListener("dragstart",function(r){r.object.material.emissive.set(11184810)}),e.addEventListener("dragend",function(r){r.object.material.emissive.set(0)})}function z(){y=new THREE.Vector3(50,20,50);var n=new THREE.Vector3(-6.8/2,10,-6),e=new THREE.Vector3(6.8/2,10,-6);p=new THREE.Scene;var t=new THREE.SphereGeometry(10,32,22),a=new THREE.MeshPhongMaterial({color:11184810}),r=new THREE.Mesh(t,a);r.name="Head",r.position.set(y.x,y.y,y.z),p.add(r);var t=new THREE.SphereGeometry(3,32,22),a=new THREE.MeshPhongMaterial({color:16711680}),o=new THREE.Mesh(t,a);o.name="EyeL",o.position.set(n.x,n.y,n.z),r.add(o);var t=new THREE.SphereGeometry(3,32,22),a=new THREE.MeshPhongMaterial({color:255}),o=new THREE.Mesh(t,a);o.name="EyeR",o.position.set(e.x,e.y,e.z),r.add(o),M(p)}function D(){s=new THREE.WebGLRenderer({preserveDrawingBuffer:!0,antialiasing:!0,alpha:!0}),s.autoClear=!1,s.setPixelRatio(window.devicePixelRatio),s.setSize(window.innerWidth,window.innerHeight),s.setAnimationLoop(P),s.shadowMap.enabled=!0,s.xr.enabled=!0,s.xr.cameraAutoUpdate=!1,document.body.appendChild(s.domElement)}function B(n,e){R=new THREE.OrbitControls(n,e.domElement),R.minDistance=120,R.maxDistance=5e4}function M(n){var e=new THREE.AmbientLight(8947848,.4);n.add(e);var r=new THREE.PointLight(16777215,.8);r.position.z+=200,n.add(r)}function A(){v=new THREE.Scene;var n=new THREE.TeapotGeometry(40,15),e=new THREE.MeshPhongMaterial({color:16777215}),r=new THREE.Mesh(n,e);r.name="Teapot",r.position.z-=70,v.add(r),M(v)}function N(){x=new THREE.Scene;for(var[n,e]of E.entries()){var r=e.origin,t=e.u,a=e.v,o=new THREE.BoxGeometry(t.length(),a.length(),.01),l=new THREE.MeshPhongMaterial({map:H[n].texture}),c=new THREE.Mesh(o,l);c.name=e.name,e.name=="Left"&&(c.rotation.y=Math.PI/2),e.name=="Right"&&(c.rotation.y=-Math.PI/2),e.name=="Floor"&&(c.rotation.x=Math.PI/2,c.rotation.z=Math.PI);var w=t.clone().multiplyScalar(.5),i=a.clone().multiplyScalar(.5),d=new THREE.Vector3().addVectors(r,w);d.add(i),c.position.set(d.x,d.y,d.z),x.add(c)}M(x)}function X(){H=[];for(var e of E)H.push(new THREE.WebGLRenderTarget(1024,1024))}function W(){u=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e4),u.position.set(100,100,300),u.lookAt(0,0,0)}function k(){var n=300,e=n/2;E=[];var r=new T("Front",new THREE.Vector3(-e,-e,-e),new THREE.Vector3(n,0,0),new THREE.Vector3(0,n,0));E.push(r);var t=new T("Left",new THREE.Vector3(-e,-e,e),new THREE.Vector3(0,0,-n),new THREE.Vector3(0,n,0));E.push(t);var a=new T("Right",new THREE.Vector3(e,-e,-e),new THREE.Vector3(0,0,n),new THREE.Vector3(0,n,0));E.push(a);var o=new T("Floor",new THREE.Vector3(-e,-e,e),new THREE.Vector3(n,0,0),new THREE.Vector3(0,0,-n));E.push(o)}function b(){var n=p.getObjectByName("EyeL");return n.getWorldPosition(new THREE.Vector3)}function L(){var n=p.getObjectByName("EyeR");return n.getWorldPosition(new THREE.Vector3)}function V(n,e){var r=u.clone(),t=new THREE.Matrix4;return t.copy(n).invert(),r.position.set(t.elements[12],t.elements[13],t.elements[14]),r.setRotationFromMatrix(n),r.projectionMatrix=e.clone(),r}function F(){document.body.appendChild(O.createButton(s,{optionalFeatures:["depth-sensing"],depthSensing:{usagePreference:["gpu-optimized"],dataFormatPreference:[]}}))}function I(){u.aspect=window.innerWidth/window.innerHeight,u.updateProjectionMatrix(),s.setSize(window.innerWidth,window.innerHeight)}var P=function(){var n=s.getContext();s.setClearColor(8421504),s.clear(),S&&s.render(v,u);for(let[l,c]of E.entries()){s.setRenderTarget(H[l]),s.setClearColor(4210752),s.clear(),n.colorMask(1,0,0,0);var r=b(),t=c.viewMatrix(r),a=c.projectionMatrix(r,1,1e4),e=V(t,a);s.render(v,e),n.colorMask(0,1,1,0);var r=L(),t=c.viewMatrix(r),a=c.projectionMatrix(r,1,1e4),o=V(t,a);s.clearDepth(),s.render(v,o),n.colorMask(1,1,1,0)}s.setRenderTarget(null),s.setClearColor(0),s.render(x,u),s.render(p,u)};window.addEventListener("keydown",function(n){switch(n.code){case"KeyL":var e=b();u.position.set(e.x,e.y,e.z);break;case"KeyR":var e=L();u.position.set(e.x,e.y,e.z);break;case"KeyS":S=!S;break;case"KeyT":var r=E[0].viewMatrix(new THREE.Vector3(50,20,100)),t=E[1].viewMatrix(new THREE.Vector3(50,20,100));console.log("View matrices:"),console.log(r),console.log(t);break;case"KeyY":var a=E[0].projectionMatrix(new THREE.Vector3(50,20,100),.1,100),o=E[1].projectionMatrix(new THREE.Vector3(50,20,100),.1,100),l=E[2].projectionMatrix(new THREE.Vector3(50,20,100),.1,100),c=E[3].projectionMatrix(new THREE.Vector3(50,20,100),.1,100);console.log("Projection matrices:"),console.log(a),console.log(o),console.log(l),console.log(c);break}});window.addEventListener("resize",I);D();F();k();X();N();z();A();W();B(u,s);j();P();
