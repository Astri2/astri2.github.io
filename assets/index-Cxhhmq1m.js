(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&t(l)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function t(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}})();class j{static createButton(e,r={}){const t=document.createElement("button");function o(i){let d=null;async function w(p){p.addEventListener("end",g),await e.xr.setSession(p),t.textContent="STOP XR",d=p}function g(){d.removeEventListener("end",g),t.textContent="START XR",d=null}t.style.display="",t.style.cursor="pointer",t.style.left="calc(50% - 50px)",t.style.width="100px",t.textContent="START XR";const m={...r,optionalFeatures:["local-floor","bounded-floor","layers",...r.optionalFeatures||[]]};t.onmouseenter=function(){t.style.opacity="1.0"},t.onmouseleave=function(){t.style.opacity="0.5"},t.onclick=function(){d===null?navigator.xr.requestSession(i,m).then(w):(d.end(),navigator.xr.offerSession!==void 0&&navigator.xr.offerSession(i,m).then(w).catch(p=>{console.warn(p)}))},navigator.xr.offerSession!==void 0&&navigator.xr.offerSession(i,m).then(w).catch(p=>{console.warn(p)})}function a(){t.style.display="",t.style.cursor="auto",t.style.left="calc(50% - 75px)",t.style.width="150px",t.onmouseenter=null,t.onmouseleave=null,t.onclick=null}function l(){a(),t.textContent="XR NOT SUPPORTED"}function c(i){a(),console.warn("Exception when trying to call xr.isSessionSupported",i),t.textContent="XR NOT ALLOWED"}function u(i){i.style.position="absolute",i.style.bottom="20px",i.style.padding="12px 6px",i.style.border="1px solid #fff",i.style.borderRadius="4px",i.style.background="rgba(0,0,0,0.1)",i.style.color="#fff",i.style.font="normal 13px sans-serif",i.style.textAlign="center",i.style.opacity="0.5",i.style.outline="none",i.style.zIndex="999"}if("xr"in navigator)return t.id="XRButton",t.style.display="none",u(t),navigator.xr.isSessionSupported("immersive-ar").then(function(i){i?o("immersive-ar"):navigator.xr.isSessionSupported("immersive-vr").then(function(d){d?o("immersive-vr"):l()}).catch(c)}).catch(c),t;{const i=document.createElement("a");return window.isSecureContext===!1?(i.href=document.location.href.replace(/^http:/,"https:"),i.innerHTML="WEBXR NEEDS HTTPS"):(i.href="https://immersiveweb.dev/",i.innerHTML="WEBXR NOT AVAILABLE"),i.style.left="calc(50% - 90px)",i.style.width="180px",i.style.textDecoration="none",u(i),i}}}class y{constructor(e,r,t,o){this.name=e,this.origin=r,this.u=t,this.v=o}viewMatrix(e){var r=new THREE.Vector3().crossVectors(this.u,this.v).normalize(),t=new THREE.Vector3().subVectors(e,r),o=new THREE.Vector3(0,1,0),a=new THREE.Matrix4;a=a.lookAt(e,t,o);var l=new THREE.Matrix4().makeTranslation(-e.x,-e.y,-e.z);return a=a.multiplyMatrices(a,l),a}projectionMatrix(e,r,t){var o=new THREE.Vector3().crossVectors(this.u,this.v).normalize(),a=-o.dot(new THREE.Vector3().subVectors(this.origin,e)),l=this.u.clone().normalize(),c=this.v.clone().normalize(),u=new THREE.Vector3().subVectors(this.origin,e).dot(l),i=new THREE.Vector3().addVectors(this.origin,this.u).sub(e).dot(l),d=new THREE.Vector3().subVectors(this.origin,e).dot(c),w=new THREE.Vector3().addVectors(this.origin,this.v).sub(e).dot(c),g=u*r/a,m=i*r/a,p=d*r/a,C=w*r/a;return new THREE.Matrix4().makePerspective(g,m,C,p,r,t)}}var s,h,E,f,T,H,x,v,R,b=!1;function O(){var n=[];n.push(h.getObjectByName("Teapot")),n.push(v.getObjectByName("Head"));var e=new THREE.DragControls(n,E,s.domElement);e.addEventListener("hoveron",function(r){R.enabled=!1}),e.addEventListener("hoveroff",function(r){R.enabled=!0}),e.addEventListener("dragstart",function(r){r.object.material.emissive.set(11184810)}),e.addEventListener("dragend",function(r){r.object.material.emissive.set(0)})}function B(){x=new THREE.Vector3(50,20,50);var n=new THREE.Vector3(-6.8/2,10,-6),e=new THREE.Vector3(6.8/2,10,-6);v=new THREE.Scene;var t=new THREE.SphereGeometry(10,32,22),o=new THREE.MeshPhongMaterial({color:11184810}),r=new THREE.Mesh(t,o);r.name="Head",r.position.set(x.x,x.y,x.z),v.add(r);var t=new THREE.SphereGeometry(3,32,22),o=new THREE.MeshPhongMaterial({color:16711680}),a=new THREE.Mesh(t,o);a.name="EyeL",a.position.set(n.x,n.y,n.z),r.add(a);var t=new THREE.SphereGeometry(3,32,22),o=new THREE.MeshPhongMaterial({color:255}),a=new THREE.Mesh(t,o);a.name="EyeR",a.position.set(e.x,e.y,e.z),r.add(a),S(v)}function z(){s=new THREE.WebGLRenderer({preserveDrawingBuffer:!0,antialiasing:!0}),s.autoClear=!1,s.setPixelRatio(window.devicePixelRatio),s.setSize(window.innerWidth,window.innerHeight),s.setAnimationLoop(P),s.shadowMap.enabled=!0,s.xr.enabled=!0,s.xr.cameraAutoUpdate=!0,document.body.appendChild(s.domElement),s.xr.addEventListener("sessionstart",()=>{R.enabled=!1}),s.xr.addEventListener("sessionend",()=>{R.enabled=!0})}function D(n,e){R=new THREE.OrbitControls(n,e.domElement),R.minDistance=120,R.maxDistance=5e4}function S(n){var e=new THREE.AmbientLight(8947848,.4);n.add(e);var r=new THREE.PointLight(16777215,.8);r.position.z+=200,n.add(r)}function N(){h=new THREE.Scene;var n=new THREE.TeapotGeometry(40,15),e=new THREE.MeshPhongMaterial({color:16777215}),r=new THREE.Mesh(n,e);r.name="Teapot",r.position.z-=70,h.add(r),S(h)}function W(){T=new THREE.Scene;for(var[n,e]of f.entries()){var r=e.origin,t=e.u,o=e.v,a=new THREE.BoxGeometry(t.length(),o.length(),.01),l=new THREE.MeshPhongMaterial({map:H[n].texture}),c=new THREE.Mesh(a,l);c.name=e.name,e.name=="Left"&&(c.rotation.y=Math.PI/2),e.name=="Right"&&(c.rotation.y=-Math.PI/2),e.name=="Floor"&&(c.rotation.x=Math.PI/2,c.rotation.z=Math.PI);var u=t.clone().multiplyScalar(.5),i=o.clone().multiplyScalar(.5),d=new THREE.Vector3().addVectors(r,u);d.add(i),c.position.set(d.x,d.y,d.z),T.add(c)}S(T)}function A(){H=[];for(var e of f)H.push(new THREE.WebGLRenderTarget(1024,1024))}function X(){E=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e4),E.position.set(100,100,300),E.lookAt(0,0,0)}function F(){var n=300,e=n/2;f=[];var r=new y("Front",new THREE.Vector3(-e,-e,-e),new THREE.Vector3(n,0,0),new THREE.Vector3(0,n,0));f.push(r);var t=new y("Left",new THREE.Vector3(-e,-e,e),new THREE.Vector3(0,0,-n),new THREE.Vector3(0,n,0));f.push(t);var o=new y("Right",new THREE.Vector3(e,-e,-e),new THREE.Vector3(0,0,n),new THREE.Vector3(0,n,0));f.push(o);var a=new y("Floor",new THREE.Vector3(-e,-e,e),new THREE.Vector3(n,0,0),new THREE.Vector3(0,0,-n));f.push(a)}function M(){var n=v.getObjectByName("EyeL");return n.getWorldPosition(new THREE.Vector3)}function L(){var n=v.getObjectByName("EyeR");return n.getWorldPosition(new THREE.Vector3)}function V(n,e){var r=E.clone(),t=new THREE.Matrix4;return t.copy(n).invert(),r.position.set(t.elements[12],t.elements[13],t.elements[14]),r.setRotationFromMatrix(n),r.projectionMatrix=e.clone(),r}function k(){document.body.appendChild(j.createButton(s,{optionalFeatures:["depth-sensing"],depthSensing:{usagePreference:["gpu-optimized"],dataFormatPreference:[]}}))}function I(){E.aspect=window.innerWidth/window.innerHeight,E.updateProjectionMatrix(),s.setSize(window.innerWidth,window.innerHeight)}const P=function(){const n=s.getContext(),e=s.xr.isPresenting,r=e?s.xr.getCamera(E):E;let t=null,o=null;if(e){const l=s.xr.getCamera(E);l.cameras&&l.cameras.length>=2?(t=new THREE.Vector3().setFromMatrixPosition(l.cameras[0].matrixWorld),o=new THREE.Vector3().setFromMatrixPosition(l.cameras[1].matrixWorld)):(t=new THREE.Vector3().setFromMatrixPosition(l.matrixWorld),o=t.clone());const c=v.getObjectByName("Head");c&&c.position.copy(new THREE.Vector3().addVectors(t,o).multiplyScalar(.5));const u=v.getObjectByName("EyeL"),i=v.getObjectByName("EyeR");u&&u.getWorldPosition(new THREE.Vector3),u&&u.position.copy(t.clone().sub(c.position)),i&&i.position.copy(o.clone().sub(c.position))}s.setClearColor(8421504),s.clear(),b&&s.render(h,r);const a=s.xr.enabled;s.xr.enabled=!1;for(const[l,c]of f.entries()){s.setRenderTarget(H[l]),s.setClearColor(4210752),s.clear();const u=t||M(),i=c.viewMatrix(u),d=c.projectionMatrix(u,1,1e4);n.colorMask(!0,!1,!1,!1);{const p=V(i,d);s.render(h,p)}const w=o||L(),g=c.viewMatrix(w),m=c.projectionMatrix(w,1,1e4);n.colorMask(!1,!0,!0,!1);{const p=V(g,m);s.clearDepth(),s.render(h,p)}n.colorMask(!0,!0,!0,!1)}s.xr.enabled=a,s.setRenderTarget(null),s.setClearColor(0),s.render(T,E),s.render(v,E)};window.addEventListener("keydown",function(n){switch(n.code){case"KeyL":var e=M();E.position.set(e.x,e.y,e.z);break;case"KeyR":var e=L();E.position.set(e.x,e.y,e.z);break;case"KeyS":b=!b;break;case"KeyT":var r=f[0].viewMatrix(new THREE.Vector3(50,20,100)),t=f[1].viewMatrix(new THREE.Vector3(50,20,100));console.log("View matrices:"),console.log(r),console.log(t);break;case"KeyY":var o=f[0].projectionMatrix(new THREE.Vector3(50,20,100),.1,100),a=f[1].projectionMatrix(new THREE.Vector3(50,20,100),.1,100),l=f[2].projectionMatrix(new THREE.Vector3(50,20,100),.1,100),c=f[3].projectionMatrix(new THREE.Vector3(50,20,100),.1,100);console.log("Projection matrices:"),console.log(o),console.log(a),console.log(l),console.log(c);break}});window.addEventListener("resize",I);z();k();F();A();W();B();N();X();D(E,s);O();P();
