(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))t(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&t(d)}).observe(document,{childList:!0,subtree:!0});function r(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function t(a){if(a.ep)return;a.ep=!0;const n=r(a);fetch(a.href,n)}})();class O{static createButton(e,r={}){const t=document.createElement("button");function a(i){let l=null;async function m(f){f.addEventListener("end",g),await e.xr.setSession(f),t.textContent="STOP XR",l=f}function g(){l.removeEventListener("end",g),t.textContent="START XR",l=null}t.style.display="",t.style.cursor="pointer",t.style.left="calc(50% - 50px)",t.style.width="100px",t.textContent="START XR";const R={...r,optionalFeatures:["local-floor","bounded-floor","layers",...r.optionalFeatures||[]]};t.onmouseenter=function(){t.style.opacity="1.0"},t.onmouseleave=function(){t.style.opacity="0.5"},t.onclick=function(){l===null?navigator.xr.requestSession(i,R).then(m):(l.end(),navigator.xr.offerSession!==void 0&&navigator.xr.offerSession(i,R).then(m).catch(f=>{console.warn(f)}))},navigator.xr.offerSession!==void 0&&navigator.xr.offerSession(i,R).then(m).catch(f=>{console.warn(f)})}function n(){t.style.display="",t.style.cursor="auto",t.style.left="calc(50% - 75px)",t.style.width="150px",t.onmouseenter=null,t.onmouseleave=null,t.onclick=null}function d(){n(),t.textContent="XR NOT SUPPORTED"}function c(i){n(),console.warn("Exception when trying to call xr.isSessionSupported",i),t.textContent="XR NOT ALLOWED"}function v(i){i.style.position="absolute",i.style.bottom="20px",i.style.padding="12px 6px",i.style.border="1px solid #fff",i.style.borderRadius="4px",i.style.background="rgba(0,0,0,0.1)",i.style.color="#fff",i.style.font="normal 13px sans-serif",i.style.textAlign="center",i.style.opacity="0.5",i.style.outline="none",i.style.zIndex="999"}if("xr"in navigator)return t.id="XRButton",t.style.display="none",v(t),navigator.xr.isSessionSupported("immersive-ar").then(function(i){i?a("immersive-ar"):navigator.xr.isSessionSupported("immersive-vr").then(function(l){l?a("immersive-vr"):d()}).catch(c)}).catch(c),t;{const i=document.createElement("a");return window.isSecureContext===!1?(i.href=document.location.href.replace(/^http:/,"https:"),i.innerHTML="WEBXR NEEDS HTTPS"):(i.href="https://immersiveweb.dev/",i.innerHTML="WEBXR NOT AVAILABLE"),i.style.left="calc(50% - 90px)",i.style.width="180px",i.style.textDecoration="none",v(i),i}}}class T{constructor(e,r,t,a){this.name=e,this.origin=r,this.u=t,this.v=a}viewMatrix(e){var r=new THREE.Vector3().crossVectors(this.u,this.v).normalize(),t=new THREE.Vector3().subVectors(e,r),a=new THREE.Vector3(0,1,0),n=new THREE.Matrix4;n=n.lookAt(e,t,a);var d=new THREE.Matrix4().makeTranslation(-e.x,-e.y,-e.z);return n=n.multiplyMatrices(n,d),n}projectionMatrix(e,r,t){var a=new THREE.Vector3().crossVectors(this.u,this.v).normalize(),n=-a.dot(new THREE.Vector3().subVectors(this.origin,e)),d=this.u.clone().normalize(),c=this.v.clone().normalize(),v=new THREE.Vector3().subVectors(this.origin,e).dot(d),i=new THREE.Vector3().addVectors(this.origin,this.u).sub(e).dot(d),l=new THREE.Vector3().subVectors(this.origin,e).dot(c),m=new THREE.Vector3().addVectors(this.origin,this.v).sub(e).dot(c),g=v*r/n,R=i*r/n,f=l*r/n,C=m*r/n;return new THREE.Matrix4().makePerspective(g,R,C,f,r,t)}}var s,p,u,E,y,H,x,w,h,S=!0;function j(){var o=[];o.push(p.getObjectByName("Teapot")),o.push(w.getObjectByName("Head"));var e=new THREE.DragControls(o,u,s.domElement);e.addEventListener("hoveron",function(r){h.enabled=!1}),e.addEventListener("hoveroff",function(r){h.enabled=!0}),e.addEventListener("dragstart",function(r){r.object.material.emissive.set(11184810)}),e.addEventListener("dragend",function(r){r.object.material.emissive.set(0)})}function z(){x=new THREE.Vector3(50,20,50);var o=new THREE.Vector3(-6.8/2,10,-6),e=new THREE.Vector3(6.8/2,10,-6);w=new THREE.Scene;var t=new THREE.SphereGeometry(10,32,22),a=new THREE.MeshPhongMaterial({color:11184810}),r=new THREE.Mesh(t,a);r.name="Head",r.position.set(x.x,x.y,x.z),w.add(r);var t=new THREE.SphereGeometry(3,32,22),a=new THREE.MeshPhongMaterial({color:16711680}),n=new THREE.Mesh(t,a);n.name="EyeL",n.position.set(o.x,o.y,o.z),r.add(n);var t=new THREE.SphereGeometry(3,32,22),a=new THREE.MeshPhongMaterial({color:255}),n=new THREE.Mesh(t,a);n.name="EyeR",n.position.set(e.x,e.y,e.z),r.add(n),b(w)}function D(){s=new THREE.WebGLRenderer({preserveDrawingBuffer:!0,antialiasing:!0}),s.autoClear=!1,s.setPixelRatio(window.devicePixelRatio),s.setSize(window.innerWidth,window.innerHeight),s.setAnimationLoop(P),s.shadowMap.enabled=!0,s.xr.enabled=!0,s.xr.cameraAutoUpdate=!1,document.body.appendChild(s.domElement),s.xr.addEventListener("sessionstart",()=>{h.enabled=!1}),s.xr.addEventListener("sessionend",()=>{h.enabled=!0})}function B(o,e){h=new THREE.OrbitControls(o,e.domElement),h.minDistance=120,h.maxDistance=5e4}function b(o){var e=new THREE.AmbientLight(8947848,.4);o.add(e);var r=new THREE.PointLight(16777215,.8);r.position.z+=200,o.add(r)}function A(){p=new THREE.Scene;var o=new THREE.TeapotGeometry(40,15),e=new THREE.MeshPhongMaterial({color:16777215}),r=new THREE.Mesh(o,e);r.name="Teapot",r.position.z-=70,p.add(r),b(p)}function N(){y=new THREE.Scene;for(var[o,e]of E.entries()){var r=e.origin,t=e.u,a=e.v,n=new THREE.BoxGeometry(t.length(),a.length(),.01),d=new THREE.MeshPhongMaterial({map:H[o].texture}),c=new THREE.Mesh(n,d);c.name=e.name,e.name=="Left"&&(c.rotation.y=Math.PI/2),e.name=="Right"&&(c.rotation.y=-Math.PI/2),e.name=="Floor"&&(c.rotation.x=Math.PI/2,c.rotation.z=Math.PI);var v=t.clone().multiplyScalar(.5),i=a.clone().multiplyScalar(.5),l=new THREE.Vector3().addVectors(r,v);l.add(i),c.position.set(l.x,l.y,l.z),y.add(c)}b(y)}function X(){H=[];for(var e of E)H.push(new THREE.WebGLRenderTarget(1024,1024))}function W(){u=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e4),u.position.set(100,100,300),u.lookAt(0,0,0)}function k(){var o=300,e=o/2;E=[];var r=new T("Front",new THREE.Vector3(-e,-e,-e),new THREE.Vector3(o,0,0),new THREE.Vector3(0,o,0));E.push(r);var t=new T("Left",new THREE.Vector3(-e,-e,e),new THREE.Vector3(0,0,-o),new THREE.Vector3(0,o,0));E.push(t);var a=new T("Right",new THREE.Vector3(e,-e,-e),new THREE.Vector3(0,0,o),new THREE.Vector3(0,o,0));E.push(a);var n=new T("Floor",new THREE.Vector3(-e,-e,e),new THREE.Vector3(o,0,0),new THREE.Vector3(0,0,-o));E.push(n)}function V(){var o=w.getObjectByName("EyeL");return o.getWorldPosition(new THREE.Vector3)}function L(){var o=w.getObjectByName("EyeR");return o.getWorldPosition(new THREE.Vector3)}function M(o,e){var r=u.clone(),t=new THREE.Matrix4;return t.copy(o).invert(),r.position.set(t.elements[12],t.elements[13],t.elements[14]),r.setRotationFromMatrix(o),r.projectionMatrix=e.clone(),r}function F(){document.body.appendChild(O.createButton(s,{optionalFeatures:["depth-sensing"],depthSensing:{usagePreference:["gpu-optimized"],dataFormatPreference:[]}}))}function I(){u.aspect=window.innerWidth/window.innerHeight,u.updateProjectionMatrix(),s.setSize(window.innerWidth,window.innerHeight)}var P=function(){var o=s.getContext();s.setClearColor(8421504),s.clear(),S&&s.render(p,u);var e=1;const r=s.getRenderTarget(),t=s.xr.enabled;s.xr.enabled=!1;for(let[i,l]of E.entries()){s.setRenderTarget(H[i]),s.setClearColor(4210752),s.clear(),o.colorMask(1,0,0,e);var n=V(),d=l.viewMatrix(n),c=l.projectionMatrix(n,1,1e4),a=M(d,c);s.render(p,a),o.colorMask(0,1,1,e);var n=L(),d=l.viewMatrix(n),c=l.projectionMatrix(n,1,1e4),v=M(d,c);s.clearDepth(),s.render(p,v),o.colorMask(1,1,1,e)}s.setRenderTarget(null),s.setClearColor(0),s.setRenderTarget(r),s.xr.enabled=t,s.render(y,u),s.render(w,u)};window.addEventListener("keydown",function(o){switch(o.code){case"KeyL":var e=V();u.position.set(e.x,e.y,e.z);break;case"KeyR":var e=L();u.position.set(e.x,e.y,e.z);break;case"KeyS":S=!S;break;case"KeyT":var r=E[0].viewMatrix(new THREE.Vector3(50,20,100)),t=E[1].viewMatrix(new THREE.Vector3(50,20,100));console.log("View matrices:"),console.log(r),console.log(t);break;case"KeyY":var a=E[0].projectionMatrix(new THREE.Vector3(50,20,100),.1,100),n=E[1].projectionMatrix(new THREE.Vector3(50,20,100),.1,100),d=E[2].projectionMatrix(new THREE.Vector3(50,20,100),.1,100),c=E[3].projectionMatrix(new THREE.Vector3(50,20,100),.1,100);console.log("Projection matrices:"),console.log(a),console.log(n),console.log(d),console.log(c);break}});window.addEventListener("resize",I);D();F();k();X();N();z();A();W();B(u,s);j();P();
